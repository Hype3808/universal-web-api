<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Web-to-API Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.staticfile.org/vue/3.3.4/vue.global.prod.min.js"></script>
    <script>
        // Tailwind dark mode é…ç½®
        tailwind.config = {
            darkMode: 'class'
        }
    </script>
    <style>
        [v-cloak] {
            display: none;
        }

        /* æ»šåŠ¨æ¡ç¾åŒ– */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e0;
            border-radius: 4px;
        }

            ::-webkit-scrollbar-thumb:hover {
                background: #a0aec0;
            }

        /* Dark mode æ»šåŠ¨æ¡ */
        .dark ::-webkit-scrollbar-thumb {
            background: #4a5568;
        }

            .dark ::-webkit-scrollbar-thumb:hover {
                background: #718096;
            }

        /* è®¾ç½®é¡µé¢æ ·å¼é‡æ„ - åˆ—è¡¨é£æ ¼ï¼ˆçº¯ CSS ç‰ˆï¼‰ */
        .settings-container {
            max-width: 56rem; /* çº¦ç­‰äº Tailwind çš„ max-w-4xl */
            margin: 0 auto;
            padding-bottom: 2.5rem; /* pb-10 */
            padding-top: 0.5rem;
        }

        .settings-group {
            background-color: #ffffff;
            border-radius: 0.5rem; /* rounded-lg */
            border: 1px solid #e5e7eb; /* border-gray-200 */
            box-shadow: 0 1px 2px rgba(15, 23, 42, 0.08); /* shadow-sm */
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .dark .settings-group {
            background-color: #1f2937; /* gray-800 */
            border-color: #374151; /* gray-700 */
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.6);
        }

        .settings-group-header {
            padding: 1rem 1.5rem; /* px-6 py-4 */
            background-color: #f9fafb; /* gray-50 */
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            transition: background-color 0.15s ease;
        }

            .settings-group-header:hover {
                background-color: #f3f4f6; /* gray-100 */
            }

        .dark .settings-group-header {
            background-color: #1f2937; /* gray-800 */
            border-color: #374151; /* gray-700 */
        }

            .dark .settings-group-header:hover {
                background-color: #111827; /* gray-900-ish */
            }

        .settings-group-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.95rem;
            font-weight: 700;
            color: #111827;
        }

        .dark .settings-group-title {
            color: #f9fafb;
        }

        .settings-group-content {
            padding: 0 1.5rem; /* px-6 */
        }

        /* æ¯ä¸€è¡Œé…ç½®é¡¹ï¼šå·¦æ–‡å­—å³æ§ä»¶ */
        .settings-row {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            padding: 1rem 0; /* py-4 */
            border-bottom: 1px solid #f3f4f6;
        }

            .settings-row:last-child {
                border-bottom: none;
            }

        @media (min-width: 640px) { /* sm: */
            .settings-row {
                flex-direction: row;
                align-items: center;
                justify-content: space-between;
            }
        }

        .dark .settings-row {
            border-color: #374151; /* gray-700 */
        }

        .settings-left {
            flex: 1 1 auto;
            padding-right: 1rem;
            min-width: 0;
        }

        .settings-right {
            width: 100%;
            max-width: 20rem; /* å·®ä¸å¤šç­‰äº Tailwind çš„ w-1/2 max-w-sm */
            display: flex;
            justify-content: flex-end;
        }

        .settings-label {
            font-size: 0.875rem;
            font-weight: 500;
            color: #111827; /* gray-900 */
        }

        .dark .settings-label {
            color: #f9fafb; /* white-ish */
        }

        .settings-desc {
            margin-top: 0.25rem;
            font-size: 0.75rem;
            line-height: 1.5;
            color: #6b7280; /* gray-500 */
        }

        .dark .settings-desc {
            color: #9ca3af; /* gray-400 */
        }

        /* è¾“å…¥æ¡†ç»Ÿä¸€æ ·å¼ */
        .settings-input {
            width: 100%;
            padding: 0.5rem 0.75rem; /* px-3 py-2 */
            font-size: 0.875rem;
            border-radius: 0.375rem; /* rounded-md */
            border: 1px solid #d1d5db; /* gray-300 */
            background-color: #ffffff;
            color: #111827;
            outline: none;
            transition: box-shadow 0.15s ease, border-color 0.15s ease, background-color 0.15s ease;
        }

            .settings-input::placeholder {
                color: #9ca3af; /* gray-400 */
            }

            .settings-input:focus {
                border-color: #2563eb; /* blue-600 */
                box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.35);
            }

        .dark .settings-input {
            background-color: #030712; /* near black */
            border-color: #4b5563; /* gray-600 */
            color: #f9fafb;
        }

            .dark .settings-input::placeholder {
                color: #6b7280;
            }

            .dark .settings-input:focus {
                border-color: #3b82f6; /* blue-500 */
                box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.45);
            }

        /* Toggle å¼€å…³ï¼ˆä¸ä¾èµ– Tailwind å˜ä½“ï¼‰ */
        .toggle-label {
            position: relative;
            display: inline-flex;
            align-items: center;
            cursor: pointer;
        }

            .toggle-label input {
                position: absolute;
                opacity: 0;
                width: 0;
                height: 0;
            }

        .toggle-bg {
            width: 44px; /* çº¦ç­‰äº w-11 */
            height: 24px; /* çº¦ç­‰äº h-6 */
            background-color: #e5e7eb; /* gray-200 */
            border-radius: 9999px;
            position: relative;
            transition: background-color 0.2s ease;
        }

            .toggle-bg::after {
                content: "";
                position: absolute;
                top: 2px;
                left: 2px;
                width: 20px;
                height: 20px;
                background-color: #ffffff;
                border-radius: 9999px;
                box-shadow: 0 1px 2px rgba(15, 23, 42, 0.2);
                transition: transform 0.2s ease;
            }

        .toggle-label input:checked + .toggle-bg {
            background-color: #2563eb; /* blue-600 */
        }

            .toggle-label input:checked + .toggle-bg::after {
                transform: translateX(20px);
            }

        .dark .toggle-bg {
            background-color: #374151; /* gray-700 */
        }

        .dark .toggle-label input:checked + .toggle-bg {
            background-color: #2563eb;
        }
    </style>
    <!-- SVG å›¾æ ‡åº“ -->
    <script>
        const icons = {
            beaker: `<svg class="w-4 h-4 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"/></svg>`,
            
            arrowDownTray: `<svg class="w-4 h-4 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"/></svg>`,
            
            arrowPath: `<svg class="w-4 h-4 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"/></svg>`,
            
            plusCircle: `<svg class="w-4 h-4 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v6m3-3H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>`,
            
            trash: `<svg class="w-4 h-4 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"/></svg>`,
            
            xMark: `<svg class="w-4 h-4 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>`,
            
            chevronUp: `<svg class="w-3 h-3 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.5 15.75l7.5-7.5 7.5 7.5"/></svg>`,
            
            chevronDown: `<svg class="w-3 h-3 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.5 8.25l-7.5 7.5-7.5-7.5"/></svg>`,
            
            clipboardList: `<svg class="w-4 h-4 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/></svg>`,
            
            chartBar: `<svg class="w-4 h-4 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z"/></svg>`,
            
            arrowUpTray: `<svg class="w-4 h-4 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5"/></svg>`,
            
            cog: `<svg class="w-4 h-4 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.343 3.94c.09-.542.56-.94 1.11-.94h1.093c.55 0 1.02.398 1.11.94l.149.894c.07.424.384.764.78.93.398.164.855.142 1.205-.108l.737-.527a1.125 1.125 0 011.45.12l.773.774c.39.389.44 1.002.12 1.45l-.527.737c-.25.35-.272.806-.107 1.204.165.397.505.71.93.78l.893.15c.543.09.94.56.94 1.109v1.094c0 .55-.397 1.02-.94 1.11l-.893.149c-.425.07-.765.383-.93.78-.165.398-.143.854.107 1.204l.527.738c.32.447.269 1.06-.12 1.45l-.774.773a1.125 1.125 0 01-1.449.12l-.738-.527c-.35-.25-.806-.272-1.203-.107-.397.165-.71.505-.781.929l-.149.894c-.09.542-.56.94-1.11.94h-1.094c-.55 0-1.019-.398-1.11-.94l-.148-.894c-.071-.424-.384-.764-.781-.93-.398-.164-.854-.142-1.204.108l-.738.527c-.447.32-1.06.269-1.45-.12l-.773-.774a1.125 1.125 0 01-.12-1.45l.527-.737c.25-.35.273-.806.108-1.204-.165-.397-.505-.71-.93-.78l-.894-.15c-.542-.09-.94-.56-.94-1.109v-1.094c0-.55.398-1.02.94-1.11l.894-.149c.424-.07.765-.383.93-.78.165-.398.143-.854-.107-1.204l-.527-.738a1.125 1.125 0 01.12-1.45l.773-.773a1.125 1.125 0 011.45-.12l.737.527c.35.25.807.272 1.204.107.397-.165.71-.505.78-.929l.15-.894z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>`,
            
            folderOpen: `<svg class="w-4 h-4 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.75 9.776c.112-.017.227-.026.344-.026h15.812c.117 0 .232.009.344.026m-16.5 0a2.25 2.25 0 00-1.883 2.542l.857 6a2.25 2.25 0 002.227 1.932H19.05a2.25 2.25 0 002.227-1.932l.857-6a2.25 2.25 0 00-1.883-2.542m-16.5 0V6A2.25 2.25 0 016 3.75h3.879a1.5 1.5 0 011.06.44l2.122 2.12a1.5 1.5 0 001.06.44H18A2.25 2.25 0 0120.25 9v.776"/></svg>`,
            
            documentArrowDown: `<svg class="w-4 h-4 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m.75 12l3 3m0 0l3-3m-3 3v-6m-1.5-9H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"/></svg>`,
            
            arrowPathRoundedSquare: `<svg class="w-4 h-4 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.5 12c0-1.232-.046-2.453-.138-3.662a4.006 4.006 0 00-3.7-3.7 48.678 48.678 0 00-7.324 0 4.006 4.006 0 00-3.7 3.7c-.017.22-.032.441-.046.662M19.5 12l3-3m-3 3l-3-3m-12 3c0 1.232.046 2.453.138 3.662a4.006 4.006 0 003.7 3.7 48.656 48.656 0 007.324 0 4.006 4.006 0 003.7-3.7c.017-.22.032-.441.046-.662M4.5 12l3 3m-3-3l-3 3"/></svg>`
        };

        window.$icons = icons;
    </script>
</head>
<body class="bg-gray-50 dark:bg-gray-900 transition-colors duration-300">
    <div id="app" class="flex h-screen" v-cloak @click="closeAllMenus">
        
        <!-- éšè—çš„æ–‡ä»¶è¾“å…¥æ¡†ï¼ˆç”¨äºå¯¼å…¥ï¼‰ -->
        <input type="file" 
               ref="importFileInput" 
               accept=".json" 
               class="hidden" 
               @change="handleImportFile">
        
        <!-- Toast é€šçŸ¥ -->
        <div class="fixed top-4 right-4 z-50 max-w-sm">
            <div v-for="toast in toasts" 
                 :key="toast.id" 
                 :class="['px-4 py-2 rounded shadow-lg text-white mb-2 transition-opacity duration-300', 
                          {'bg-green-500': toast.type === 'success', 
                           'bg-red-500': toast.type === 'error', 
                           'bg-blue-500': toast.type === 'info', 
                           'bg-yellow-500': toast.type === 'warning'}]"
                 @click="removeToast(toast.id)">
                {{ toast.message }}
            </div>
        </div>

        <!-- å·¦ä¾§æ  -->
        <aside class="w-64 bg-white dark:bg-gray-800 border-r dark:border-gray-700 flex flex-col">
            <!-- çŠ¶æ€æ  -->
            <div class="p-3 border-b dark:border-gray-700 bg-gray-50 dark:bg-gray-900">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm font-semibold dark:text-white">æœåŠ¡çŠ¶æ€</span>
                    <div class="flex gap-2">
                        <button @click.stop="toggleDarkMode" 
                                class="text-xs hover:text-blue-700 dark:hover:text-blue-400"
                                :title="darkMode ? 'åˆ‡æ¢åˆ°æ—¥é—´æ¨¡å¼' : 'åˆ‡æ¢åˆ°å¤œé—´æ¨¡å¼'">
                            {{ darkMode ? 'â˜€ï¸' : 'ğŸŒ™' }}
                        </button>
                        <button @click="refreshStatus" class="text-xs text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300">
                            åˆ·æ–°
                        </button>
                    </div>
                </div>
                <div class="text-xs space-y-1">
                    <div class="flex items-center dark:text-gray-300">
                        <span :class="['inline-block w-2 h-2 rounded-full mr-1', browserStatus.connected ? 'bg-green-500' : 'bg-red-500']"></span>
                        <span>æµè§ˆå™¨: {{ browserStatus.connected ? 'å·²è¿æ¥' : 'æœªè¿æ¥' }}</span>
                    </div>
                    <div class="text-gray-600 dark:text-gray-400">
                        ç«™ç‚¹é…ç½®: {{ Object.keys(sites).length }} ä¸ª
                    </div>
                    <div v-if="authEnabled" class="text-gray-600 dark:text-gray-400 flex items-center justify-between">
                        <span>ğŸ”’ è®¤è¯: {{ hasToken ? 'å·²é…ç½®' : 'æœªé…ç½®' }}</span>
                        <button @click.stop="showTokenDialog = true" class="text-blue-500 dark:text-blue-400">è®¾ç½®</button>
                    </div>
                </div>
            </div>

            <!-- æœç´¢ -->
            <div class="p-3 border-b dark:border-gray-700">
                <input v-model="searchQuery" 
                       placeholder="æœç´¢ç«™ç‚¹..." 
                       class="border dark:border-gray-700 px-2 py-1 rounded focus:outline-none focus:border-blue-400 w-full text-sm bg-white dark:bg-gray-700 dark:text-white dark:placeholder-gray-400">
            </div>

            <!-- ç«™ç‚¹åˆ—è¡¨ -->
            <div class="flex-1 overflow-auto">
                <div v-for="domain in filteredSites" 
                     :key="domain" 
                     @click="selectSite(domain)" 
                     class="cursor-pointer px-3 py-2 border-b dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors group"
                     :class="{'bg-blue-50 dark:bg-blue-900/30 border-l-4 border-l-blue-500': currentDomain === domain}">
                    <div class="flex items-center justify-between">
                        <span class="text-sm dark:text-white truncate flex-1">{{ domain }}</span>
                        <button @click.stop="confirmDelete(domain)" 
                                class="text-red-500 opacity-0 group-hover:opacity-100 transition-opacity text-xs">
                            <span v-html="$icons.trash"></span>
                        </button>
                    </div>
                </div>
                <div v-if="filteredSites.length === 0" class="p-4 text-center text-gray-400 dark:text-gray-500 text-sm">
                    æ— åŒ¹é…ç»“æœ
                </div>
            </div>

            <!-- åº•éƒ¨æ“ä½œ -->
            <div class="p-3 border-t dark:border-gray-700 space-y-2">
                <button @click="addNewSite" class="px-3 py-1 border dark:border-gray-700 rounded transition-colors bg-blue-500 text-white hover:bg-blue-600 border-blue-500 w-full text-sm">
                    <span v-html="$icons.plusCircle"></span> æ–°å¢ç«™ç‚¹
                </button>
                <div class="flex gap-2">
                    <!-- å¯¼å…¥æŒ‰é’® -->
                    <button @click="triggerImport" class="flex-1 px-3 py-1 border dark:border-gray-700 rounded hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-white transition-colors text-sm">
                        <span v-html="$icons.documentArrowDown"></span> å¯¼å…¥
                    </button>
                    <!-- å¯¼å‡ºæŒ‰é’® -->
                    <button @click="exportConfig" class="flex-1 px-3 py-1 border dark:border-gray-700 rounded hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-white transition-colors text-sm">
                        <span v-html="$icons.arrowUpTray"></span> å¯¼å‡º
                    </button>
                </div>
            </div>
        </aside>

        <!-- ä¸»å†…å®¹åŒº -->
        <main class="flex-1 flex flex-col overflow-hidden bg-gray-50 dark:bg-gray-900">
            
            <!-- å¤´éƒ¨ï¼ˆä»…åœ¨é…ç½®/æ—¥å¿— Tab æ˜¾ç¤ºï¼‰ -->
            <header v-if="activeTab !== 'settings' && currentDomain && currentConfig" 
                    class="bg-white dark:bg-gray-800 border-b dark:border-gray-700 p-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center gap-4">
                        <h2 class="text-xl font-bold dark:text-white">{{ currentDomain }}</h2>
                        <label class="flex items-center text-sm cursor-pointer dark:text-gray-300">
                            <input type="checkbox" 
                                   v-model="currentConfig.stealth" 
                                   class="mr-2">
                            <span>éšèº«æ¨¡å¼</span>
                        </label>
                    </div>
                    <div class="flex gap-2">
                        <button @click="testCurrentSite" class="border dark:border-gray-700 rounded hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-white transition-colors px-2 py-0.5 text-sm">
                            <span v-html="$icons.beaker"></span> æµ‹è¯•é€‰æ‹©å™¨
                        </button>
                        <button @click="showJsonPreview = true" class="border dark:border-gray-700 rounded hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-white transition-colors px-2 py-0.5 text-sm">
                            æŸ¥çœ‹ JSON
                        </button>
                        <button @click="reanalyzeCurrentSite" class="border dark:border-gray-700 rounded hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-white transition-colors px-2 py-0.5 text-sm">
                            é‡æ–°åˆ†æ
                        </button>
                        <button @click="loadConfig" class="border dark:border-gray-700 rounded hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-white transition-colors px-2 py-0.5 text-sm">
                            <span v-html="$icons.arrowPath"></span> åˆ·æ–°
                        </button>
                        <button @click="saveConfig" 
                                :disabled="isSaving"
                                :class="['border rounded transition-colors px-2 py-0.5 text-sm', isSaving ? 'opacity-50 cursor-not-allowed px-3 py-1 hover:bg-gray-100 dark:text-gray-400' : 'bg-blue-500 text-white hover:bg-blue-600 border-blue-500']">
                            <span v-if="!isSaving" v-html="$icons.arrowDownTray"></span>
                            {{ isSaving ? 'ä¿å­˜ä¸­...' : ' ä¿å­˜' }}
                        </button>
                    </div>
                </div>
            </header>
            
            <!-- è®¾ç½®é¡µå¤´éƒ¨ -->
            <header v-if="activeTab === 'settings'" 
                    class="bg-white dark:bg-gray-800 border-b dark:border-gray-700 p-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <span v-html="$icons.cog" class="text-gray-600 dark:text-gray-400"></span>
                        <h2 class="text-xl font-bold dark:text-white">ç³»ç»Ÿè®¾ç½®</h2>
                    </div>
                    <div class="flex gap-2">
                        <button @click="loadEnvConfig(); loadBrowserConstants()" 
                                class="border dark:border-gray-700 rounded hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-white transition-colors px-2 py-0.5 text-sm">
                            <span v-html="$icons.arrowPath"></span> åˆ·æ–°
                        </button>
                    </div>
                </div>
            </header>

            <!-- Tab åˆ‡æ¢æ  -->
            <div class="bg-white dark:bg-gray-800 border-b dark:border-gray-700 px-4 flex gap-2">
                <button @click="activeTab = 'config'" 
                        :class="['px-4 py-2 text-sm font-medium border-b-2 transition-colors', 
                                 activeTab === 'config' 
                                 ? 'border-blue-500 text-blue-600 dark:text-blue-400' 
                                 : 'border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300']">
                    <span v-html="$icons.clipboardList"></span> é…ç½®
                </button>
                <button @click="activeTab = 'logs'" 
                        :class="['px-4 py-2 text-sm font-medium border-b-2 transition-colors', 
                                 activeTab === 'logs' 
                                 ? 'border-blue-500 text-blue-600 dark:text-blue-400' 
                                 : 'border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300']">
                    <span v-html="$icons.chartBar"></span> æ—¥å¿—
                    <span v-if="logs.length > 0" class="ml-1 px-1.5 py-0.5 text-xs bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-300 rounded-full">{{ logs.length }}</span>
                </button>
                <button @click="activeTab = 'settings'" 
                        :class="['px-4 py-2 text-sm font-medium border-b-2 transition-colors', 
                                 activeTab === 'settings' 
                                 ? 'border-blue-500 text-blue-600 dark:text-blue-400' 
                                 : 'border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300']">
                    <span v-html="$icons.cog"></span> è®¾ç½®
                    <span v-if="envConfigChanged || browserConstantsChanged" 
                          class="ml-1 w-2 h-2 bg-orange-500 rounded-full inline-block"></span>
                </button>
            </div>

            <!-- Tab å†…å®¹åŒº -->
            <div class="flex-1 overflow-hidden">

                <!-- ==================== é…ç½® Tab ==================== -->
                <div v-show="activeTab === 'config'" class="h-full overflow-auto p-4">

                    <!-- éœ€è¦é€‰æ‹©ç«™ç‚¹æç¤º -->
                    <div v-if="!currentDomain || !currentConfig" class="h-full flex items-center justify-center">
                        <div class="text-center text-gray-400 dark:text-gray-500">
                            <div class="text-4xl mb-4">ğŸ“</div>
                            <div class="text-lg">è¯·é€‰æ‹©æˆ–æ–°å¢ç«™ç‚¹é…ç½®</div>
                        </div>
                    </div>

                    <!-- ç«™ç‚¹é…ç½®å†…å®¹ -->
                    <div v-else class="space-y-4">

                        <!-- é€‰æ‹©å™¨æŠ˜å é¢æ¿ -->
                        <div class="bg-white dark:bg-gray-800 border dark:border-gray-700 rounded">
                            <div class="px-4 py-3 border-b dark:border-gray-700 flex justify-between items-center cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700"
                                 @click="selectorCollapsed = !selectorCollapsed">
                                <div class="flex items-center gap-2">
                                    <span v-html="selectorCollapsed ? $icons.chevronDown : $icons.chevronUp"></span>
                                    <h3 class="font-semibold dark:text-white">ğŸ·ï¸ é€‰æ‹©å™¨</h3>
                                    <span class="text-sm text-gray-500 dark:text-gray-400">({{ Object.keys(currentConfig.selectors).length }})</span>
                                </div>
                                <div class="relative" @click.stop>
                                    <button @click.stop="toggleSelectorMenu"
                                            class="border rounded transition-colors bg-blue-500 text-white hover:bg-blue-600 border-blue-500 px-2 py-0.5 text-sm">
                                        <span v-html="$icons.plusCircle"></span> æ–°å¢ <span v-html="$icons.chevronDown"></span>
                                    </button>

                                    <!-- ä¸‹æ‹‰èœå• -->
                                    <div v-if="showSelectorMenu"
                                         class="absolute right-0 mt-1 w-56 bg-white dark:bg-gray-800 border dark:border-gray-700 rounded shadow-lg z-10">
                                        <button @click.stop="addSelector('custom')"
                                                class="w-full text-left px-3 py-2 hover:bg-gray-50 dark:hover:bg-gray-700 dark:text-white text-sm border-b dark:border-gray-700">
                                            è‡ªå®šä¹‰å­—æ®µ
                                        </button>
                                        <div class="px-3 py-1 text-xs text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-900">
                                            å¯é€‰å­—æ®µï¼ˆæ”¹è¿›å†…å®¹æŠ“å–ï¼‰
                                        </div>
                                        <button @click.stop="addSelector('message_wrapper')"
                                                class="w-full text-left px-3 py-2 hover:bg-gray-50 dark:hover:bg-gray-700 text-xs">
                                            <div class="font-semibold dark:text-white">message_wrapper</div>
                                            <div class="text-gray-500 dark:text-gray-400">æ¶ˆæ¯å®Œæ•´å®¹å™¨ï¼ˆç”¨äºå¤šèŠ‚ç‚¹æ‹¼æ¥ï¼‰</div>
                                        </button>
                                        <button @click.stop="addSelector('generating_indicator')"
                                                class="w-full text-left px-3 py-2 hover:bg-gray-50 dark:hover:bg-gray-700 text-xs">
                                            <div class="font-semibold dark:text-white">generating_indicator</div>
                                            <div class="text-gray-500 dark:text-gray-400">ç”Ÿæˆä¸­æŒ‡ç¤ºå™¨ï¼ˆæ£€æµ‹æ˜¯å¦è¿˜åœ¨è¾“å‡ºï¼‰</div>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- å¯æŠ˜å å†…å®¹ -->
                            <div v-show="!selectorCollapsed" class="p-4 space-y-3 max-h-96 overflow-auto">
                                <div v-for="(val, key) in currentConfig.selectors"
                                     :key="key"
                                     class="p-3 border dark:border-gray-700 rounded hover:border-blue-300 dark:hover:border-blue-600 transition-colors">
                                    <input :value="key"
                                           @blur="updateSelectorKey(key, $event.target.value)"
                                           class="border dark:border-gray-700 px-2 py-1 rounded focus:outline-none focus:border-blue-400 font-semibold w-full mb-2 text-sm bg-white dark:bg-gray-700 dark:text-white"
                                           placeholder="é”®å">
                                    <input v-model="currentConfig.selectors[key]"
                                           class="border dark:border-gray-700 px-2 py-1 rounded focus:outline-none focus:border-blue-400 w-full bg-gray-50 dark:bg-gray-900 text-sm font-mono dark:text-gray-300"
                                           placeholder="CSS é€‰æ‹©å™¨">
                                    <div class="mt-2 flex justify-between">
                                        <button @click="testSelector(key, val)"
                                                class="border dark:border-gray-700 rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors px-2 py-0.5 text-sm text-xs text-blue-500 dark:text-blue-400">
                                            æµ‹è¯•
                                        </button>
                                        <button @click="removeSelector(key)"
                                                class="border rounded transition-colors bg-red-500 text-white hover:bg-red-600 border-red-500 px-2 py-0.5 text-sm text-xs">
                                            <span v-html="$icons.trash"></span>
                                        </button>
                                    </div>
                                </div>
                                <div v-if="Object.keys(currentConfig.selectors).length === 0"
                                     class="text-center text-gray-400 dark:text-gray-500 text-sm py-8">
                                    æš‚æ— é€‰æ‹©å™¨ï¼Œç‚¹å‡»æ–°å¢æ·»åŠ 
                                </div>
                            </div>
                        </div>

                        <!-- å·¥ä½œæµæŠ˜å é¢æ¿ -->
                        <div class="bg-white dark:bg-gray-800 border dark:border-gray-700 rounded">
                            <div class="px-4 py-3 border-b dark:border-gray-700 flex justify-between items-center cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700"
                                 @click="workflowCollapsed = !workflowCollapsed">
                                <div class="flex items-center gap-2">
                                    <span v-html="workflowCollapsed ? $icons.chevronDown : $icons.chevronUp"></span>
                                    <h3 class="font-semibold dark:text-white">âš™ï¸ å·¥ä½œæµ</h3>
                                    <span class="text-sm text-gray-500 dark:text-gray-400">({{ currentConfig.workflow.length }} æ­¥)</span>
                                </div>
                                <div class="flex gap-2" @click.stop>
                                    <button @click="showStepTemplates = true" class="border dark:border-gray-700 rounded hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-white transition-colors px-2 py-0.5 text-sm">
                                        <span v-html="$icons.clipboardList"></span> æ¨¡æ¿
                                    </button>
                                    <button @click="addStep()" class="border rounded transition-colors bg-blue-500 text-white hover:bg-blue-600 border-blue-500 px-2 py-0.5 text-sm">
                                        <span v-html="$icons.plusCircle"></span> æ–°å¢æ­¥éª¤
                                    </button>
                                </div>
                            </div>

                            <!-- å¯æŠ˜å å†…å®¹ -->
                            <div v-show="!workflowCollapsed" class="p-4 space-y-3 max-h-96 overflow-auto">
                                <div v-for="(step, index) in currentConfig.workflow"
                                     :key="index"
                                     class="border dark:border-gray-700 rounded p-3 hover:border-blue-300 dark:hover:border-blue-600 transition-colors">
                                    <div class="flex gap-3 items-start">

                                        <!-- æ­¥éª¤åºå· -->
                                        <div class="flex flex-col items-center gap-1 pt-1">
                                            <span class="text-xs font-semibold text-gray-500 dark:text-gray-400 w-6 text-center">
                                                {{ index + 1 }}
                                            </span>
                                            <div class="flex flex-col">
                                                <button @click="moveStep(index, -1)"
                                                        :disabled="index === 0"
                                                        class="hover:text-blue-500 dark:hover:text-blue-400 disabled:text-gray-300 dark:disabled:text-gray-600">
                                                    <span v-html="$icons.chevronUp"></span>
                                                </button>
                                                <button @click="moveStep(index, 1)"
                                                        :disabled="index === currentConfig.workflow.length - 1"
                                                        class="hover:text-blue-500 dark:hover:text-blue-400 disabled:text-gray-300 dark:disabled:text-gray-600">
                                                    <span v-html="$icons.chevronDown"></span>
                                                </button>
                                            </div>
                                        </div>

                                        <!-- åŠ¨ä½œç±»å‹ -->
                                        <div class="w-32">
                                            <label class="text-xs text-gray-500 dark:text-gray-400">åŠ¨ä½œ</label>
                                            <select v-model="step.action"
                                                    @change="onActionChange(step)"
                                                    class="border dark:border-gray-700 px-2 py-1 rounded focus:outline-none focus:border-blue-400 w-full text-sm mt-1 bg-white dark:bg-gray-700 dark:text-white">
                                                <option value="FILL_INPUT">å¡«å…¥å†…å®¹</option>
                                                <option value="CLICK">ç‚¹å‡»å…ƒç´ </option>
                                                <option value="STREAM_WAIT">æµå¼ç­‰å¾…</option>
                                                <option value="WAIT">ç­‰å¾…</option>
                                                <option value="KEY_PRESS">æŒ‰é”®</option>
                                            </select>
                                        </div>

                                        <!-- ç›®æ ‡/å‚æ•° -->
                                        <div class="flex-1">
                                            <label class="text-xs text-gray-500 dark:text-gray-400">
                                                {{ ['FILL_INPUT', 'CLICK', 'STREAM_WAIT'].includes(step.action) ? 'ç›®æ ‡é€‰æ‹©å™¨' : 'å‚æ•°' }}
                                            </label>

                                            <!-- é€‰æ‹©å™¨å¼•ç”¨ -->
                                            <select v-if="['FILL_INPUT', 'CLICK', 'STREAM_WAIT'].includes(step.action)"
                                                    v-model="step.target"
                                                    class="border dark:border-gray-700 px-2 py-1 rounded focus:outline-none focus:border-blue-400 w-full mt-1 text-sm bg-white dark:bg-gray-700 dark:text-white">
                                                <option value="" disabled>é€‰æ‹©é€‰æ‹©å™¨...</option>
                                                <option v-for="(v, k) in currentConfig.selectors"
                                                        :key="k"
                                                        :value="k">
                                                    {{ k }} ({{ v || 'æœªè®¾ç½®' }})
                                                </option>
                                            </select>

                                            <!-- æŒ‰é”®è¾“å…¥ -->
                                            <input v-else-if="step.action === 'KEY_PRESS'"
                                                   v-model="step.target"
                                                   placeholder="ä¾‹å¦‚: Enter"
                                                   class="border dark:border-gray-700 px-2 py-1 rounded focus:outline-none focus:border-blue-400 w-full mt-1 text-sm bg-white dark:bg-gray-700 dark:text-white">

                                            <!-- ç­‰å¾…æ—¶é—´ -->
                                            <div v-else-if="step.action === 'WAIT'" class="flex items-center gap-2 mt-1">
                                                <input v-model.number="step.value"
                                                       type="number"
                                                       step="0.1"
                                                       min="0"
                                                       class="border dark:border-gray-700 px-2 py-1 rounded focus:outline-none focus:border-blue-400 w-24 text-sm bg-white dark:bg-gray-700 dark:text-white">
                                                <span class="text-sm text-gray-500 dark:text-gray-400">ç§’</span>
                                            </div>
                                        </div>

                                        <!-- å¯é€‰æ ‡å¿— -->
                                        <div class="pt-6">
                                            <label class="flex items-center text-xs cursor-pointer whitespace-nowrap dark:text-gray-300">
                                                <input type="checkbox"
                                                       v-model="step.optional"
                                                       class="mr-1">
                                                <span>å¯é€‰</span>
                                            </label>
                                        </div>

                                        <!-- åˆ é™¤æŒ‰é’® -->
                                        <div class="pt-6">
                                            <button @click="removeStep(index)"
                                                    class="text-red-500 hover:text-red-700">
                                                <span v-html="$icons.xMark"></span>
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <div v-if="currentConfig.workflow.length === 0"
                                     class="text-center text-gray-400 dark:text-gray-500 text-sm py-8">
                                    æš‚æ— å·¥ä½œæµæ­¥éª¤ï¼Œç‚¹å‡»æ–°å¢æ­¥éª¤æˆ–ä½¿ç”¨æ¨¡æ¿
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ==================== æ—¥å¿— Tab ==================== -->
                <div v-show="activeTab === 'logs'" class="h-full flex flex-col bg-white dark:bg-gray-800">
                    <!-- æ—¥å¿—è¿‡æ»¤æ  -->
                    <div class="p-4 border-b dark:border-gray-700 flex justify-between items-center">
                        <div class="flex gap-2">
                            <button @click="logLevelFilter = 'ALL'"
                                    :class="['px-3 py-1 text-sm rounded', logLevelFilter === 'ALL' ? 'bg-blue-500 text-white' : 'border dark:border-gray-700 dark:text-gray-300']">
                                å…¨éƒ¨
                            </button>
                            <button @click="logLevelFilter = 'INFO'"
                                    :class="['px-3 py-1 text-sm rounded', logLevelFilter === 'INFO' ? 'bg-gray-500 text-white' : 'border dark:border-gray-700 dark:text-gray-300']">
                                INFO
                            </button>
                            <button @click="logLevelFilter = 'AI'"
                                    :class="['px-3 py-1 text-sm rounded', logLevelFilter === 'AI' ? 'bg-purple-500 text-white' : 'border dark:border-gray-700 dark:text-gray-300']">
                                AI
                            </button>
                            <button @click="logLevelFilter = 'WARN'"
                                    :class="['px-3 py-1 text-sm rounded', logLevelFilter === 'WARN' ? 'bg-yellow-500 text-white' : 'border dark:border-gray-700 dark:text-gray-300']">
                                WARN
                            </button>
                            <button @click="logLevelFilter = 'ERROR'"
                                    :class="['px-3 py-1 text-sm rounded', logLevelFilter === 'ERROR' ? 'bg-red-500 text-white' : 'border dark:border-gray-700 dark:text-gray-300']">
                                ERROR
                            </button>
                        </div>
                        <div class="flex gap-2">
                            <button @click="pauseLogs = !pauseLogs" class="border dark:border-gray-700 rounded px-3 py-1 text-sm dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700">
                                {{ pauseLogs ? 'â–¶ï¸ ç»§ç»­' : 'â¸ æš‚åœ' }}
                            </button>
                            <button @click="clearLogs" class="border dark:border-gray-700 rounded px-3 py-1 text-sm dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700">
                                <span v-html="$icons.trash"></span> æ¸…é™¤
                            </button>
                        </div>
                    </div>

                    <!-- æ—¥å¿—åˆ—è¡¨ -->
                    <div ref="logContainer" class="flex-1 overflow-auto p-4 font-mono text-sm space-y-1">
                        <div v-for="log in filteredLogs" :key="log.id"
                             :class="['p-2 rounded', getLogColorClass(log.level)]">
                            <span class="text-gray-500 dark:text-gray-300">{{ log.timestamp }}</span>
                            <span :class="['font-bold mx-2', getLogLevelClass(log.level)]">[{{ log.level }}]</span>
                            <span class="dark:text-gray-200">{{ log.message }}</span>
                        </div>
                        <div v-if="filteredLogs.length === 0" class="text-center text-gray-400 dark:text-gray-500 py-8">
                            æš‚æ— æ—¥å¿—
                        </div>
                    </div>
                </div>

                <!-- ==================== è®¾ç½® Tab ==================== -->
                <div v-show="activeTab === 'settings'" class="h-full overflow-auto p-4 md:p-6 bg-gray-50 dark:bg-gray-900">
                    <div class="settings-container">

                        <!-- é¡¶éƒ¨æ“ä½œæ  -->
                        <div class="flex justify-between items-center mb-2">
                            <div>
                                <h3 class="text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2">
                                    <span v-html="$icons.folderOpen"></span> ç¯å¢ƒé…ç½® (.env)
                                </h3>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">éƒ¨åˆ†é…ç½®ï¼ˆå¦‚ç«¯å£ã€è®¤è¯ï¼‰éœ€è¦é‡å¯æœåŠ¡æ‰èƒ½ç”Ÿæ•ˆ</p>
                            </div>
                            <div class="flex gap-3">
                                <button @click="resetEnvConfig"
                                        class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                                    é‡ç½®
                                </button>
                                <button @click="saveEnvConfig"
                                        :disabled="isSavingEnv || !envConfigChanged"
                                        :class="['px-4 py-2 text-sm font-medium text-white rounded-lg transition-colors flex items-center gap-2',
                                                 isSavingEnv || !envConfigChanged
                                                 ? 'bg-blue-400 cursor-not-allowed opacity-70'
                                                 : 'bg-blue-600 hover:bg-blue-700 shadow-sm']">
                                    <span v-if="!isSavingEnv" v-html="$icons.arrowDownTray"></span>
                                    {{ isSavingEnv ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜å˜æ›´' }}
                                </button>
                            </div>
                        </div>

                        <!-- ç¯å¢ƒé…ç½®åˆ†ç»„ -->
                        <div v-for="(group, groupKey) in envSchema" :key="groupKey" class="settings-group">
                            <!-- åˆ†ç»„æ ‡é¢˜ -->
                            <div class="settings-group-header" @click="envCollapsed[groupKey] = !envCollapsed[groupKey]">
                                <div class="settings-group-title">
                                    <span class="text-lg opacity-80">{{ group.icon }}</span>
                                    <span>{{ group.label }}</span>
                                </div>
                                <span v-html="envCollapsed[groupKey] ? $icons.chevronDown : $icons.chevronUp" class="text-gray-500"></span>
                            </div>

                            <!-- åˆ†ç»„å†…å®¹ï¼ˆåˆ—è¡¨å¼ï¼‰ -->
                            <div v-show="!envCollapsed[groupKey]" class="settings-group-content">
                                <div v-for="(field, fieldKey) in group.items" :key="fieldKey" class="settings-row">
                                    <!-- å·¦ä¾§ï¼šæ–‡å­—æè¿° -->
                                    <div class="settings-left">
                                        <div class="settings-label">
                                            {{ field.label }}
                                            <span v-if="field.unit" class="text-gray-400 font-normal text-xs ml-1">{{ field.unit }}</span>
                                        </div>
                                        <div v-if="field.desc" class="settings-desc">{{ field.desc }}</div>
                                    </div>

                                    <!-- å³ä¾§ï¼šæ§ä»¶ -->
                                    <div class="settings-right">
                                        <!-- å¼€å…³ -->
                                        <div v-if="field.type === 'switch'">
                                            <label class="toggle-label">
                                                <input type="checkbox" v-model="envConfig[fieldKey]" class="sr-only peer">
                                                <div class="toggle-bg"></div>
                                            </label>
                                        </div>

                                        <!-- ä¸‹æ‹‰é€‰æ‹© -->
                                        <select v-else-if="field.type === 'select'" v-model="envConfig[fieldKey]" class="settings-input">
                                            <option v-for="opt in field.options" :key="opt" :value="opt">{{ opt }}</option>
                                        </select>

                                        <!-- å¯†ç æ¡† -->
                                        <input v-else-if="field.type === 'password'"
                                               type="password"
                                               v-model="envConfig[fieldKey]"
                                               :placeholder="field.default ? 'é»˜è®¤: ' + field.default : ''"
                                               class="settings-input">

                                        <!-- æ•°å­—è¾“å…¥ -->
                                        <input v-else-if="field.type === 'number'"
                                               type="number"
                                               v-model.number="envConfig[fieldKey]"
                                               :min="field.min" :max="field.max" :step="field.step || 1"
                                               :placeholder="field.default"
                                               class="settings-input">

                                        <!-- æ–‡æœ¬è¾“å…¥ -->
                                        <input v-else
                                               type="text"
                                               v-model="envConfig[fieldKey]"
                                               :placeholder="field.default ? 'é»˜è®¤: ' + field.default : ''"
                                               class="settings-input">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- åˆ†éš” -->
                        <div class="py-4 border-t border-gray-200 dark:border-gray-700"></div>

                        <!-- æµè§ˆå™¨å¸¸é‡ -->
                        <div class="flex justify-between items-center mb-2">
                            <div>
                                <h3 class="text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2">
                                    <span>ğŸŒ</span> æµè§ˆå™¨å¸¸é‡
                                </h3>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">ä¿®æ”¹åç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¯æœåŠ¡</p>
                            </div>
                            <div class="flex gap-3">
                                <button @click="resetBrowserConstants"
                                        class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                                    é‡ç½®
                                </button>
                                <button @click="saveBrowserConstants"
                                        :disabled="isSavingConstants || !browserConstantsChanged"
                                        :class="['px-4 py-2 text-sm font-medium text-white rounded-lg transition-colors flex items-center gap-2',
                                                 isSavingConstants || !browserConstantsChanged
                                                 ? 'bg-blue-400 cursor-not-allowed opacity-70'
                                                 : 'bg-blue-600 hover:bg-blue-700 shadow-sm']">
                                    <span v-if="!isSavingConstants" v-html="$icons.arrowDownTray"></span>
                                    {{ isSavingConstants ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜å˜æ›´' }}
                                </button>
                            </div>
                        </div>

                        <!-- æµè§ˆå™¨å¸¸é‡åˆ†ç»„ -->
                        <div v-for="(group, groupKey) in browserConstantsSchema" :key="groupKey" class="settings-group">
                            <div class="settings-group-header" @click="browserConstantsCollapsed[groupKey] = !browserConstantsCollapsed[groupKey]">
                                <div class="settings-group-title">
                                    <span class="text-lg opacity-80">{{ group.icon }}</span>
                                    <span>{{ group.label }}</span>
                                    <span v-if="group.desc" class="text-xs font-normal text-gray-400 ml-2 hidden sm:inline">- {{ group.desc }}</span>
                                </div>
                                <span v-html="browserConstantsCollapsed[groupKey] ? $icons.chevronDown : $icons.chevronUp" class="text-gray-500"></span>
                            </div>
                            <div v-show="!browserConstantsCollapsed[groupKey]" class="settings-group-content">
                                <div v-for="(field, fieldKey) in group.items" :key="fieldKey" class="settings-row">
                                    <div class="settings-left">
                                        <div class="settings-label">
                                            {{ field.label }}
                                            <span v-if="field.unit" class="text-gray-400 font-normal text-xs ml-1">{{ field.unit }}</span>
                                        </div>
                                        <div v-if="field.desc" class="settings-desc">{{ field.desc }}</div>
                                    </div>
                                    <div class="settings-right">
                                        <input type="number"
                                               v-model.number="browserConstants[fieldKey]"
                                               :min="field.min" :max="field.max" :step="field.step || 1"
                                               :placeholder="field.default"
                                               class="settings-input">
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
        </main>

        <!-- ==================== å¼¹çª—åŒºåŸŸ ==================== -->

        <!-- JSON é¢„è§ˆå¼¹çª— -->
        <div v-if="showJsonPreview" 
             class="fixed inset-0 bg-black/50 flex items-center justify-center z-40"
             @click.self="showJsonPreview = false">
            <div class="bg-white dark:bg-gray-800 rounded-lg p-6 w-2/3 max-h-[80vh] flex flex-col">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-semibold dark:text-white">é…ç½® JSON</h3>
                    <button @click="showJsonPreview = false" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300">
                        <span v-html="$icons.xMark"></span>
                    </button>
                </div>
                <pre class="flex-1 overflow-auto bg-gray-50 dark:bg-gray-900 p-4 rounded text-sm font-mono border dark:border-gray-700 dark:text-gray-300">{{ JSON.stringify(sites[currentDomain], null, 2) }}</pre>
                <div class="mt-4 flex justify-end">
                    <button @click="copyJson" class="border dark:border-gray-700 rounded hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-white transition-colors px-2 py-0.5 text-sm">
                        å¤åˆ¶åˆ°å‰ªè´´æ¿
                    </button>
                </div>
            </div>
        </div>

        <!-- Token é…ç½®å¼¹çª— -->
        <div v-if="showTokenDialog" 
             class="fixed inset-0 bg-black/50 flex items-center justify-center z-40"
             @click.self="showTokenDialog = false">
            <div class="bg-white dark:bg-gray-800 rounded-lg p-6 w-96">
                <h3 class="font-semibold dark:text-white mb-4">é…ç½®è®¤è¯ Token</h3>
                <div class="mb-4">
                    <label class="text-sm text-gray-600 dark:text-gray-400 mb-2 block">
                        Bearer Tokenï¼ˆç•™ç©ºåˆ™æ¸…é™¤ï¼‰
                    </label>
                    <input v-model="tempToken" 
                           type="password" 
                           placeholder="your-secret-token"
                           class="border dark:border-gray-700 px-2 py-1 rounded focus:outline-none focus:border-blue-400 w-full bg-white dark:bg-gray-700 dark:text-white">
                </div>
                <div class="text-xs text-gray-500 dark:text-gray-400 mb-4">
                    Token å°†ä¿å­˜åœ¨æµè§ˆå™¨æœ¬åœ°å­˜å‚¨ä¸­
                </div>
                <div class="flex justify-end gap-2">
                    <button @click="showTokenDialog = false" class="border dark:border-gray-700 rounded hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-white transition-colors px-2 py-0.5 text-sm">
                        å–æ¶ˆ
                    </button>
                    <button @click="saveToken" class="border rounded transition-colors bg-blue-500 text-white hover:bg-blue-600 border-blue-500 px-2 py-0.5 text-sm">
                        ä¿å­˜
                    </button>
                </div>
            </div>
        </div>

        <!-- æ­¥éª¤æ¨¡æ¿å¼¹çª— -->
        <div v-if="showStepTemplates" 
             class="fixed inset-0 bg-black/50 flex items-center justify-center z-40"
             @click.self="showStepTemplates = false">
            <div class="bg-white dark:bg-gray-800 rounded-lg p-6 w-[500px]">
                <h3 class="font-semibold dark:text-white mb-4">å·¥ä½œæµæ¨¡æ¿</h3>
                <div class="space-y-2 mb-4">
                    <button @click="applyTemplate('default')" 
                            class="w-full text-left p-3 border dark:border-gray-700 rounded hover:border-blue-400 dark:hover:border-blue-500 transition-colors">
                        <div class="font-semibold text-sm dark:text-white">æ ‡å‡†å¯¹è¯æµç¨‹</div>
                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                            ç‚¹å‡»æ–°å»º â†’ å¡«å…¥ â†’ ç‚¹å‡»å‘é€ â†’ ç­‰å¾… â†’ æµå¼ç›‘å¬
                        </div>
                    </button>
                    <button @click="applyTemplate('simple')" 
                            class="w-full text-left p-3 border dark:border-gray-700 rounded hover:border-blue-400 dark:hover:border-blue-500 transition-colors">
                        <div class="font-semibold text-sm dark:text-white">ç®€åŒ–æµç¨‹</div>
                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                            å¡«å…¥ â†’ å›è½¦ â†’ æµå¼ç›‘å¬
                        </div>
                    </button>
                </div>
                <div class="flex justify-end">
                    <button @click="showStepTemplates = false" class="border dark:border-gray-700 rounded hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-white transition-colors px-2 py-0.5 text-sm">
                        å…³é—­
                    </button>
                </div>
            </div>
        </div>

        <!-- é€‰æ‹©å™¨æµ‹è¯•å¼¹çª— -->
        <div v-if="showTestDialog" 
             class="fixed inset-0 bg-black/50 flex items-center justify-center z-40"
             @click.self="showTestDialog = false">
            <div class="bg-white dark:bg-gray-800 rounded-lg p-6 w-[600px]">
                <h3 class="font-semibold dark:text-white mb-4">é€‰æ‹©å™¨æµ‹è¯•</h3>
                <div class="mb-4">
                    <label class="text-sm text-gray-600 dark:text-gray-400 mb-2 block">é€‰æ‹©å™¨</label>
                    <input v-model="testSelectorInput" 
                           class="border dark:border-gray-700 px-2 py-1 rounded focus:outline-none focus:border-blue-400 w-full font-mono text-sm bg-white dark:bg-gray-700 dark:text-white"
                           placeholder="ä¾‹å¦‚: textarea">
                </div>
                <div class="mb-4">
                    <label class="text-sm text-gray-600 dark:text-gray-400 mb-2 block">è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰</label>
                    <input v-model.number="testTimeout" 
                           type="number"
                           min="1"
                           max="10"
                           class="border dark:border-gray-700 px-2 py-1 rounded focus:outline-none focus:border-blue-400 w-24 bg-white dark:bg-gray-700 dark:text-white">
                </div>
                
                <!-- é«˜äº®æ˜¾ç¤ºå¤é€‰æ¡† -->
                <div class="mb-4">
                    <label class="flex items-center text-sm cursor-pointer">
                        <input type="checkbox" v-model="testHighlight" class="mr-2">
                        <span class="dark:text-gray-300">ğŸ¨ åœ¨æµè§ˆå™¨ä¸­é«˜äº®æ˜¾ç¤º</span>
                        <span class="ml-2 text-xs text-gray-500 dark:text-gray-400">ï¼ˆå¯èƒ½è§¦å‘é£æ§ï¼Œè°¨æ…ä½¿ç”¨ï¼‰</span>
                    </label>
                </div>
                
                <!-- æµ‹è¯•ç»“æœ -->
                <div v-if="testResult" class="mb-4 p-3 rounded border"
                     :class="testResult.success ? 'bg-green-50 dark:bg-green-900/30 border-green-200 dark:border-green-800' : 'bg-red-50 dark:bg-red-900/30 border-red-200 dark:border-red-800'">
                    <div class="font-semibold text-sm mb-2 dark:text-white">
                        {{ testResult.success ? 'âœ… æ‰¾åˆ°' + (testResult.count > 1 ? ' ' + testResult.count + ' ä¸ª' : '') + 'å…ƒç´ ' : 'âŒ æœªæ‰¾åˆ°å…ƒç´ ' }}
                    </div>
                    <div v-if="testResult.success" class="text-xs space-y-1 dark:text-gray-300">
                        <div><span class="text-gray-600 dark:text-gray-400">æ ‡ç­¾:</span> &lt;{{ testResult.tag }}&gt;</div>
                        <div v-if="testResult.text">
                            <span class="text-gray-600 dark:text-gray-400">æ–‡æœ¬:</span> {{ testResult.text }}
                        </div>
                        <!-- æ˜¾ç¤ºå¤šä¸ªå…ƒç´ ä¿¡æ¯ -->
                        <div v-if="testResult.count > 1" class="mt-2">
                            <span class="text-gray-600 dark:text-gray-400">æ‰¾åˆ° {{ testResult.count }} ä¸ªå…ƒç´ :</span>
                            <div class="max-h-32 overflow-auto mt-1">
                                <div v-for="(el, idx) in testResult.elements" :key="idx" 
                                     class="text-xs p-1 border-b dark:border-gray-700">
                                    {{ idx + 1 }}. &lt;{{ el.tag }}&gt; {{ el.text ? '- ' + el.text.substring(0, 50) : '' }}
                                </div>
                            </div>
                        </div>
                        <div v-if="testResult.attributes && Object.keys(testResult.attributes).length > 0">
                            <span class="text-gray-600 dark:text-gray-400">å±æ€§:</span>
                            <pre class="text-xs mt-1 bg-white dark:bg-gray-800 p-2 rounded dark:text-gray-300">{{ JSON.stringify(testResult.attributes, null, 2) }}</pre>
                        </div>
                    </div>
                    <div v-else class="text-xs text-red-600 dark:text-red-400">
                        {{ testResult.message }}
                    </div>
                </div>
                
                <div class="flex justify-end gap-2">
                    <button @click="showTestDialog = false" class="border dark:border-gray-700 rounded hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-white transition-colors px-2 py-0.5 text-sm">
                        å…³é—­
                    </button>
                    <button @click="runTest" 
                            :disabled="!testSelectorInput || isTesting"
                            class="border rounded transition-colors bg-blue-500 text-white hover:bg-blue-600 border-blue-500 px-2 py-0.5 text-sm"
                            :class="{'opacity-50 cursor-not-allowed': !testSelectorInput || isTesting}">
                        {{ isTesting ? 'æµ‹è¯•ä¸­...' : 'æµ‹è¯•' }}
                    </button>
                </div>
            </div>
        </div>

        <!-- å¯¼å…¥ç¡®è®¤å¼¹çª— -->
        <div v-if="showImportDialog" 
             class="fixed inset-0 bg-black/50 flex items-center justify-center z-40"
             @click.self="cancelImport">
            <div class="bg-white dark:bg-gray-800 rounded-lg p-6 w-[450px]">
                <h3 class="font-semibold dark:text-white mb-4">å¯¼å…¥é…ç½®</h3>
                
                <div class="mb-4 p-3 bg-gray-50 dark:bg-gray-900 rounded border dark:border-gray-700">
                    <div class="text-sm dark:text-gray-300">
                        <span class="text-gray-600 dark:text-gray-400">æ–‡ä»¶:</span> {{ importFileName }}
                    </div>
                    <div class="text-sm dark:text-gray-300 mt-1">
                        <span class="text-gray-600 dark:text-gray-400">ç«™ç‚¹æ•°é‡:</span> {{ importedConfig ? Object.keys(importedConfig).length : 0 }} ä¸ª
                    </div>
                    <div v-if="importedConfig" class="text-xs text-gray-500 dark:text-gray-400 mt-2 max-h-24 overflow-auto">
                        {{ Object.keys(importedConfig).join(', ') }}
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="text-sm text-gray-600 dark:text-gray-400 mb-2 block">å¯¼å…¥æ¨¡å¼</label>
                    <div class="space-y-2">
                        <label class="flex items-center cursor-pointer">
                            <input type="radio" v-model="importMode" value="merge" class="mr-2">
                            <span class="dark:text-gray-300">åˆå¹¶</span>
                            <span class="text-xs text-gray-500 dark:text-gray-400 ml-2">ï¼ˆä¿ç•™ç°æœ‰é…ç½®ï¼Œç›¸åŒåŸŸåä¼šè¢«è¦†ç›–ï¼‰</span>
                        </label>
                        <label class="flex items-center cursor-pointer">
                            <input type="radio" v-model="importMode" value="replace" class="mr-2">
                            <span class="dark:text-gray-300">æ›¿æ¢</span>
                            <span class="text-xs text-gray-500 dark:text-gray-400 ml-2">ï¼ˆåˆ é™¤æ‰€æœ‰ç°æœ‰é…ç½®ï¼‰</span>
                        </label>
                    </div>
                </div>
                
                <div class="flex justify-end gap-2">
                    <button @click="cancelImport" class="border dark:border-gray-700 rounded hover:bg-gray-100 dark:hover:bg-gray-700 dark:text-white transition-colors px-3 py-1 text-sm">
                        å–æ¶ˆ
                    </button>
                    <button @click="executeImport" class="border rounded transition-colors bg-blue-500 text-white hover:bg-blue-600 border-blue-500 px-3 py-1 text-sm">
                        ç¡®è®¤å¯¼å…¥
                    </button>
                </div>
            </div>
        </div>

    </div>

    <script src="dashboard.js"></script>
</body>
</html>