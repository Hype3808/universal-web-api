# 参数详细说明

本文档详细介绍项目中所有配置参数的含义、作用和使用方法。

---

## 目录

- [环境变量 (.env)](#环境变量-env)
- [浏览器常量 (browser_config.json)](#浏览器常量-browser_configjson)
- [站点配置 (sites.json)](#站点配置-sitesjson)
- [流式监控配置 (stream_config)](#流式监控配置-stream_config)

---

## 环境变量 (.env)

环境变量用于配置服务的基础运行参数，**部分配置需要重启服务才能生效**。

### 服务配置

#### APP_HOST

```env
APP_HOST=127.0.0.1
```

- **含义**：服务监听的 IP 地址
- **作用**：决定哪些设备可以访问本服务
- **可选值**：
  - `127.0.0.1` - 仅本机可访问（**推荐**）
  - `0.0.0.0` - 局域网内所有设备可访问（有安全风险）
  - 具体 IP - 绑定到特定网卡
- **使用场景**：
  - 个人使用 → `127.0.0.1`
  - 团队共享 → `0.0.0.0`（需配合认证）
- **注意**：修改后需重启服务

---

#### APP_PORT

```env
APP_PORT=8199
```

- **含义**：服务监听的端口号
- **作用**：访问服务的端口
- **默认值**：`8199`
- **可选范围**：`1024-65535`（避免使用系统保留端口）
- **使用场景**：
  - 端口冲突时修改
  - 多实例部署时使用不同端口
- **注意**：修改后需重启服务

---

#### APP_DEBUG

```env
APP_DEBUG=true
```

- **含义**：是否启用调试模式
- **作用**：
  - `true` - 启用 `/docs` API 文档，显示详细错误信息
  - `false` - 关闭调试功能，提高安全性
- **推荐值**：
  - 开发/测试 → `true`
  - 生产环境 → `false`
- **注意**：生产环境必须设为 `false`

---

#### LOG_LEVEL

```env
LOG_LEVEL=INFO
```

- **含义**：日志输出级别
- **作用**：控制日志详细程度
- **可选值**：
  - `DEBUG` - 最详细，包含所有调试信息
  - `INFO` - 常规信息（**推荐**）
  - `WARNING` - 仅警告和错误
  - `ERROR` - 仅错误信息
- **使用场景**：
  - 排查问题 → `DEBUG`
  - 日常使用 → `INFO`
  - 减少日志 → `WARNING`

---

### 认证配置

#### AUTH_ENABLED

```env
AUTH_ENABLED=false
```

- **含义**：是否启用 API 认证
- **作用**：保护 API 不被未授权访问
- **推荐值**：
  - 本地使用 → `false`
  - 暴露到公网 → `true`（必须）
- **注意**：启用后必须配置 `AUTH_TOKEN`

---

#### AUTH_TOKEN

```env
AUTH_TOKEN=your-secret-token-here
```

- **含义**：API 访问令牌（Bearer Token）
- **作用**：客户端请求时需携带此 Token
- **生成方法**：
  ```bash
  # 生成安全随机 Token
  python -c "import secrets; print(secrets.token_urlsafe(32))"
  ```
- **使用方式**：
  ```bash
  curl -H "Authorization: Bearer your-secret-token-here" \
    http://127.0.0.1:8199/v1/chat/completions
  ```
- **安全建议**：
  - 使用 32 位以上随机字符串
  - 定期更换
  - 不要提交到代码库

---

### CORS 配置

#### CORS_ENABLED

```env
CORS_ENABLED=true
```

- **含义**：是否启用跨域资源共享
- **作用**：允许浏览器跨域访问 API
- **推荐值**：
  - Web 前端调用 → `true`
  - 仅后端调用 → `false`

---

#### CORS_ORIGINS

```env
CORS_ORIGINS=*
```

- **含义**：允许跨域访问的源列表
- **作用**：限制哪些域名可以跨域调用
- **格式**：
  - `*` - 允许所有域名（**开发时使用**）
  - `https://example.com` - 单个域名
  - `https://a.com,https://b.com` - 多个域名（逗号分隔）
- **安全建议**：生产环境应指定具体域名

---

### 浏览器配置

#### BROWSER_PORT

```env
BROWSER_PORT=9222
```

- **含义**：Chrome 远程调试端口
- **作用**：服务通过此端口连接 Chrome
- **默认值**：`9222`
- **注意事项**：
  - 必须与 Chrome 启动参数一致
  - 端口冲突时修改（需同步修改启动命令）
- **修改示例**：
  ```env
  BROWSER_PORT=9333
  ```
  对应启动命令：
  ```bash
  chrome --remote-debugging-port=9333 ...
  ```

---

### AI 分析配置

这些配置用于**辅助 AI 自动识别新网站的页面结构**。

#### HELPER_API_KEY

```env
HELPER_API_KEY=sk-xxx
```

- **含义**：辅助 AI 的 API Key
- **作用**：调用 AI 分析页面 HTML 提取选择器
- **注意**：
  - 可选配置，不配置则无法自动识别新站点
  - 需要手动在 Dashboard 中配置选择器
  - 支持任何 OpenAI 兼容 API

---

#### HELPER_BASE_URL

```env
HELPER_BASE_URL=http://127.0.0.1:5104/v1
```

- **含义**：辅助 AI 的 API 地址
- **作用**：指定 AI 服务的 endpoint
- **常见值**：
  - OpenAI: `https://api.openai.com/v1`
  - 本地服务: `http://127.0.0.1:5104/v1`
  - 其他兼容服务的地址

---

#### HELPER_MODEL

```env
HELPER_MODEL=gpt-4
```

- **含义**：辅助 AI 使用的模型名称
- **作用**：指定分析页面时调用的模型
- **推荐模型**：
  - `gpt-4` - 准确度最高（**推荐**）
  - `gpt-3.5-turbo` - 成本较低，准确度略低
  - `gemini-pro` - Google 模型

---

#### MAX_HTML_CHARS

```env
MAX_HTML_CHARS=120000
```

- **含义**：发送给 AI 的 HTML 最大字符数
- **作用**：防止页面过大导致 Token 超限
- **默认值**：`120000`（约 12 万字符）
- **调整建议**：
  - AI Token 限制小 → 减小此值
  - 分析不准确 → 适当增大
- **注意**：过大会增加 API 成本

---

### 配置文件

#### SITES_CONFIG_FILE

```env
SITES_CONFIG_FILE=sites.json
```

- **含义**：站点配置文件路径
- **作用**：指定配置存储位置
- **默认值**：`sites.json`
- **使用场景**：
  - 多配置文件管理
  - 自定义存储位置

---

## 浏览器常量 (browser_config.json)

浏览器常量控制浏览器自动化行为，**支持热更新**（修改后无需重启）。

### 连接配置

#### DEFAULT_PORT

```json
{
  "DEFAULT_PORT": 9222
}
```

- **含义**：默认 Chrome 调试端口
- **作用**：服务启动时的默认连接端口
- **默认值**：`9222`
- **注意**：通常与 `BROWSER_PORT` 保持一致

---

#### CONNECTION_TIMEOUT

```json
{
  "CONNECTION_TIMEOUT": 10
}
```

- **含义**：浏览器连接超时时间（秒）
- **作用**：连接 Chrome 时的最长等待时间
- **默认值**：`10` 秒
- **调整建议**：
  - 网络慢/机器性能差 → 增大
  - 快速失败 → 减小

---

### 操作延迟

这些参数用于**模拟人类操作**，避免被网站检测为机器人。

#### STEALTH_DELAY_MIN

```json
{
  "STEALTH_DELAY_MIN": 0.1
}
```

- **含义**：隐身模式最小延迟（秒）
- **作用**：启用 `stealth: true` 时，每次操作的最小等待时间
- **默认值**：`0.1` 秒
- **使用场景**：
  - 网站检测严格 → 增大（如 `0.3`）
  - 追求速度 → 减小（如 `0.05`）

---

#### STEALTH_DELAY_MAX

```json
{
  "STEALTH_DELAY_MAX": 0.3
}
```

- **含义**：隐身模式最大延迟（秒）
- **作用**：每次操作的随机延迟上限
- **默认值**：`0.3` 秒
- **说明**：实际延迟在 `MIN` 和 `MAX` 之间随机
- **示例**：`MIN=0.1, MAX=0.3` → 每次操作随机等待 0.1-0.3 秒

---

#### ACTION_DELAY_MIN / ACTION_DELAY_MAX

```json
{
  "ACTION_DELAY_MIN": 0.15,
  "ACTION_DELAY_MAX": 0.3
}
```

- **含义**：常规动作延迟（秒）
- **作用**：点击、输入等操作后的等待时间
- **默认值**：`0.15 - 0.3` 秒
- **区别**：与 `STEALTH_DELAY` 类似，但用于非隐身模式

---

### 元素查找

#### DEFAULT_ELEMENT_TIMEOUT

```json
{
  "DEFAULT_ELEMENT_TIMEOUT": 3
}
```

- **含义**：查找元素的默认超时时间（秒）
- **作用**：等待页面元素出现的时间
- **默认值**：`3` 秒
- **调整建议**：
  - 页面加载慢 → 增大（如 `5`）
  - 快速失败 → 减小（如 `2`）

---

#### FALLBACK_ELEMENT_TIMEOUT

```json
{
  "FALLBACK_ELEMENT_TIMEOUT": 1
}
```

- **含义**：回退选择器的超时时间（秒）
- **作用**：主选择器失败后，尝试备用选择器的等待时间
- **默认值**：`1` 秒
- **说明**：通常比 `DEFAULT_ELEMENT_TIMEOUT` 小

---

#### ELEMENT_CACHE_MAX_AGE

```json
{
  "ELEMENT_CACHE_MAX_AGE": 5.0
}
```

- **含义**：元素缓存有效期（秒）
- **作用**：已找到的元素位置缓存多久
- **默认值**：`5` 秒
- **影响**：
  - 过大 → 页面变化后可能找不到元素
  - 过小 → 增加查找开销

---

### 流式监控

这些参数控制 AI 回复的**检测频率和完成判定**，是最重要的调优参数。

#### STREAM_CHECK_INTERVAL_MIN

```json
{
  "STREAM_CHECK_INTERVAL_MIN": 0.1
}
```

- **含义**：流式检查的最小间隔（秒）
- **作用**：检测新内容的最短等待时间
- **默认值**：`0.1` 秒
- **影响**：
  - 减小 → 响应更快，但 CPU 占用高
  - 增大 → 降低 CPU 占用，但延迟增加

---

#### STREAM_CHECK_INTERVAL_MAX

```json
{
  "STREAM_CHECK_INTERVAL_MAX": 1.0
}
```

- **含义**：流式检查的最大间隔（秒）
- **作用**：长时间无新内容时的检查间隔上限
- **默认值**：`1.0` 秒
- **说明**：系统会根据内容更新速度动态调整间隔

---

#### STREAM_CHECK_INTERVAL_DEFAULT

```json
{
  "STREAM_CHECK_INTERVAL_DEFAULT": 0.3
}
```

- **含义**：流式检查的初始间隔（秒）
- **作用**：开始监控时的检查频率
- **默认值**：`0.3` 秒

---

#### STREAM_SILENCE_THRESHOLD

```json
{
  "STREAM_SILENCE_THRESHOLD": 8.0
}
```

- **含义**：静默超时阈值（秒）
- **作用**：**多久没有新内容后判定 AI 已完成回复**
- **默认值**：`8` 秒
- **重要性**：⭐⭐⭐⭐⭐（最重要参数之一）
- **调整建议**：
  - AI 回复速度快（如 GPT-4） → `3-5` 秒
  - AI 回复速度慢（如某些本地模型） → `10-15` 秒
  - 回复被提前截断 → 增大
  - 等待时间过长 → 减小

---

#### STREAM_SILENCE_THRESHOLD_FALLBACK

```json
{
  "STREAM_SILENCE_THRESHOLD_FALLBACK": 12
}
```

- **含义**：备用静默超时（秒）
- **作用**：生成指示器仍在运行时的超时阈值
- **默认值**：`12` 秒
- **使用场景**：某些网站的"生成中"指示器不准确

---

#### STREAM_MAX_TIMEOUT

```json
{
  "STREAM_MAX_TIMEOUT": 600
}
```

- **含义**：单次响应的绝对超时（秒）
- **作用**：防止无限等待
- **默认值**：`600` 秒（10 分钟）
- **调整建议**：
  - 长文本生成 → 增大
  - 避免长时间挂起 → 减小

---

#### STREAM_INITIAL_WAIT

```json
{
  "STREAM_INITIAL_WAIT": 180
}
```

- **含义**：等待首次响应的最长时间（秒）
- **作用**：AI 开始回复前的最大等待时间
- **默认值**：`180` 秒（3 分钟）
- **使用场景**：
  - 某些 AI 需要较长思考时间
  - 网络慢或排队时间长

---

#### STREAM_STABLE_COUNT_THRESHOLD

```json
{
  "STREAM_STABLE_COUNT_THRESHOLD": 8
}
```

- **含义**：稳定判定次数
- **作用**：连续多少次检查内容不变才判定完成
- **默认值**：`8` 次
- **影响**：
  - 增大 → 更保守，不容易漏内容
  - 减小 → 更快结束，但可能提前截断

---

### 流式监控（高级）

这些参数用于处理**特殊情况**，通常不需要修改。

#### STREAM_RERENDER_WAIT

```json
{
  "STREAM_RERENDER_WAIT": 0.5
}
```

- **含义**：检测到页面重新渲染后的等待时间（秒）
- **作用**：避免在重渲染时读取到不完整内容
- **默认值**：`0.5` 秒

---

#### STREAM_CONTENT_SHRINK_TOLERANCE

```json
{
  "STREAM_CONTENT_SHRINK_TOLERANCE": 3
}
```

- **含义**：内容收缩的容忍次数
- **作用**：允许内容长度暂时减少的次数（可能是重渲染）
- **默认值**：`3` 次
- **说明**：超过此次数会报错

---

#### STREAM_MIN_VALID_LENGTH

```json
{
  "STREAM_MIN_VALID_LENGTH": 10
}
```

- **含义**：最小有效内容长度（字符）
- **作用**：内容长度小于此值时不视为有效响应
- **默认值**：`10` 字符

---

#### STREAM_INITIAL_ELEMENT_WAIT

```json
{
  "STREAM_INITIAL_ELEMENT_WAIT": 10
}
```

- **含义**：等待初始元素出现的时间（秒）
- **作用**：等待响应容器元素出现
- **默认值**：`10` 秒

---

#### STREAM_MAX_ABNORMAL_COUNT

```json
{
  "STREAM_MAX_ABNORMAL_COUNT": 5
}
```

- **含义**：最大连续异常次数
- **作用**：连续异常超过此次数后中止监控
- **默认值**：`5` 次

---

#### STREAM_MAX_ELEMENT_MISSING

```json
{
  "STREAM_MAX_ELEMENT_MISSING": 10
}
```

- **含义**：元素丢失的最大容忍次数
- **作用**：元素找不到超过此次数后报错
- **默认值**：`10` 次

---

#### STREAM_CONTENT_SHRINK_THRESHOLD

```json
{
  "STREAM_CONTENT_SHRINK_THRESHOLD": 0.3
}
```

- **含义**：内容收缩的异常阈值（比例）
- **作用**：内容长度减少超过 30% 视为异常
- **默认值**：`0.3`（30%）

---

### 输入验证

#### MAX_MESSAGE_LENGTH

```json
{
  "MAX_MESSAGE_LENGTH": 100000
}
```

- **含义**：单条消息的最大长度（字符）
- **作用**：防止过长消息导致问题
- **默认值**：`100000` 字符

---

#### MAX_MESSAGES_COUNT

```json
{
  "MAX_MESSAGES_COUNT": 100
}
```

- **含义**：单次请求的最大消息数量
- **作用**：防止过多历史消息导致问题
- **默认值**：`100` 条

---

## 站点配置 (sites.json)

站点配置定义了**如何与特定网站交互**。

### selectors（选择器）

选择器用于定位页面元素，支持以下语法：

#### 语法格式

```json
{
  "selectors": {
    "input_box": "textarea#prompt",           // CSS 选择器（最常用）
    "send_btn": "xpath://*[@id='send']",      // XPath
    "result": "tag:div@@class=response",      // DrissionPage 语法
    "custom": ".class1 > .class2"             // 复杂 CSS
  }
}
```

**支持的格式**：

| 格式 | 示例 | 说明 |
|------|------|------|
| CSS | `textarea` | 标准 CSS 选择器 |
| CSS | `#id` | ID 选择器 |
| CSS | `.class` | 类选择器 |
| CSS | `div > p` | 层级选择器 |
| CSS | `[data-testid="btn"]` | 属性选择器 |
| XPath | `xpath://div[@id='x']` | XPath 表达式 |
| Tag | `tag:button` | 标签名 |
| 混合 | `tag:div@@class=msg` | DrissionPage 语法 |

---

#### 必需选择器

**input_box** - 消息输入框

```json
{
  "input_box": "textarea#prompt-textarea"
}
```

- **作用**：定位用户输入消息的文本框
- **常见元素**：`<textarea>`、`<div contenteditable="true">`
- **查找技巧**：
  1. 打开浏览器开发者工具（F12）
  2. 点击"选择元素"工具
  3. 点击输入框
  4. 查看 `id`、`class`、`name` 属性

---

**send_btn** - 发送按钮

```json
{
  "send_btn": "button[data-testid='send-button']"
}
```

- **作用**：定位发送消息的按钮
- **常见元素**：`<button type="submit">`
- **注意**：可设为 `optional: true`，改用回车发送

---

**result_container** - 回复内容容器

```json
{
  "result_container": ".agent-turn .markdown"
}
```

- **作用**：定位 AI 回复的文本内容
- **重要性**：⭐⭐⭐⭐⭐（最关键）
- **选择技巧**：
  - 必须仅包含 AI 回复，不能包含用户消息
  - 优先选择包含格式化文本的容器（如 `.markdown`）
  - 避免选择外层容器（会包含多余内容）
- **调试方法**：
  1. 在 Dashboard 中点击"测试"
  2. 检查是否高亮正确区域
  3. 检查是否包含完整回复

---

#### 可选选择器

**new_chat_btn** - 新建对话按钮

```json
{
  "new_chat_btn": "a[href='/c/new']"
}
```

- **作用**：在每次对话前创建新会话
- **使用场景**：
  - 需要清空上下文
  - 避免历史对话干扰
- **可设为 `null`**：不创建新对话

---

**message_wrapper** - 消息完整容器

```json
{
  "message_wrapper": "div[data-testid^='conversation-turn']"
}
```

- **作用**：包含完整消息的外层容器（用于多节点拼接）
- **使用场景**：
  - 回复分散在多个 `<p>` 标签中
  - 需要保留格式（代码块、列表等）
- **可设为 `null`**：使用 `result_container`

---

**generating_indicator** - 生成中指示器

```json
{
  "generating_indicator": "button[aria-label='Stop']"
}
```

- **作用**：检测 AI 是否还在生成
- **常见元素**：
  - "停止生成"按钮
  - 加载动画
  - "正在输入..."提示
- **可设为 `null`**：使用时间静默判断

---

### workflow（工作流）

工作流定义了执行步骤的顺序。

#### 步骤结构

```json
{
  "action": "CLICK",        // 动作类型
  "target": "send_btn",     // 目标（选择器名或参数）
  "optional": false,        // 是否可选
  "value": null             // 参数值
}
```

---

#### 动作类型详解

**CLICK - 点击元素**

```json
{
  "action": "CLICK",
  "target": "send_btn",     // 引用 selectors 中的键名
  "optional": true          // 失败时不中断
}
```

- **作用**：点击指定元素
- **target**：选择器名（如 `send_btn`）
- **optional**：
  - `true` - 找不到元素时跳过
  - `false` - 找不到元素时报错
- **使用场景**：点击按钮、链接

---

**FILL_INPUT - 填入内容**

```json
{
  "action": "FILL_INPUT",
  "target": "input_box",    // 输入框选择器
  "optional": false
}
```

- **作用**：向输入框填入用户消息
- **target**：选择器名（如 `input_box`）
- **内容来源**：自动从 API 请求的 `messages` 中获取
- **注意**：会先清空输入框

---

**STREAM_WAIT - 流式等待**

```json
{
  "action": "STREAM_WAIT",
  "target": "result_container",
  "optional": false
}
```

- **作用**：监控 AI 回复，实时返回内容
- **target**：回复容器选择器
- **流程**：
  1. 等待元素出现
  2. 检测内容变化
  3. 计算增量并返回
  4. 判断是否完成
- **完成条件**：
  - 静默超时
  - 生成指示器消失
  - 内容稳定

---

**WAIT - 等待固定时间**

```json
{
  "action": "WAIT",
  "target": "",             // 留空
  "value": "0.5"            // 等待秒数
}
```

- **作用**：暂停指定时间
- **value**：等待时长（秒），支持小数
- **使用场景**：
  - 等待页面加载
  - 避免操作过快被检测

---

**KEY_PRESS - 模拟按键**

```json
{
  "action": "KEY_PRESS",
  "target": "Enter",        // 键名
  "optional": true
}
```

- **作用**：模拟键盘按键
- **target**：键名（如 `Enter`、`Escape`）
- **使用场景**：
  - 回车发送消息
  - 关闭弹窗

---

#### 工作流示例

**标准流程**

```json
{
  "workflow": [
    {"action": "CLICK", "target": "new_chat_btn", "optional": true},
    {"action": "WAIT", "target": "", "value": "0.5"},
    {"action": "FILL_INPUT", "target": "input_box", "optional": false},
    {"action": "CLICK", "target": "send_btn", "optional": true},
    {"action": "STREAM_WAIT", "target": "result_container", "optional": false}
  ]
}
```

**简化流程（回车发送）**

```json
{
  "workflow": [
    {"action": "FILL_INPUT", "target": "input_box"},
    {"action": "KEY_PRESS", "target": "Enter"},
    {"action": "STREAM_WAIT", "target": "result_container"}
  ]
}
```

---

### stealth（隐身模式）

```json
{
  "stealth": true
}
```

- **含义**：是否启用隐身模式
- **作用**：
  - `true` - 添加随机延迟，模拟人类操作
  - `false` - 快速执行，无额外延迟
- **推荐场景**：
  - ChatGPT、Claude 等检测严格的网站 → `true`
  - 本地/宽松网站 → `false`
- **副作用**：
  - `true` - 响应变慢（每步增加 0.1-0.3 秒）
  - `false` - 可能被检测为机器人

---

## 流式监控配置 (stream_config)

站点级别的流式监控配置，覆盖全局默认值。

```json
{
  "stream_config": {
    "silence_threshold": 2.5,
    "initial_wait": 30.0,
    "enable_wrapper_search": true
  }
}
```

### silence_threshold

```json
{
  "silence_threshold": 2.5
}
```

- **含义**：静默超时阈值（秒）
- **作用**：覆盖 `STREAM_SILENCE_THRESHOLD`
- **使用场景**：
  - 某个网站 AI 回复特别快 → 设为 `2.0`
  - 某个网站 AI 回复特别慢 → 设为 `10.0`

---

### initial_wait

```json
{
  "initial_wait": 30.0
}
```

- **含义**：等待首次响应的时间（秒）
- **作用**：覆盖 `STREAM_INITIAL_WAIT`
- **使用场景**：网站排队时间长

---

### enable_wrapper_search

```json
{
  "enable_wrapper_search": true
}
```

- **含义**：是否启用容器向上查找
- **作用**：
  - `true` - 尝试查找完整消息容器
  - `false` - 仅使用 `result_container`

---

## 参数调优建议

### 场景1：回复被提前截断

**现象**：AI 还在输出，但服务已返回 `[DONE]`

**解决方案**：

```json
// browser_config.json
{
  "STREAM_SILENCE_THRESHOLD": 15.0,  // 增大静默超时
  "STREAM_STABLE_COUNT_THRESHOLD": 12  // 增加稳定判定次数
}
```

---

### 场景2：等待时间过长

**现象**：AI 已完成，但服务还在等待

**解决方案**：

```json
// sites.json - 站点配置
{
  "selectors": {
    "generating_indicator": "button[aria-label='Stop']"  // 添加指示器
  },
  "stream_config": {
    "silence_threshold": 3.0  // 减小超时
  }
}
```

---

### 场景3：内容不完整或乱码

**现象**：返回的内容缺失或包含多余内容

**解决方案**：

1. 检查 `result_container` 选择器
2. 在 Dashboard 中测试并高亮显示
3. 确保选择器仅匹配 AI 回复

```json
{
  "selectors": {
    // 错误：选择了外层容器
    "result_container": ".conversation",
    
    // 正确：精确到回复文本
    "result_container": ".conversation .assistant-message .text"
  }
}
```

---

### 场景4：频繁被检测为机器人

**现象**：账号被警告或封禁

**解决方案**：

```json
// sites.json
{
  "stealth": true  // 启用隐身模式
}
```

```json
// browser_config.json
{
  "STEALTH_DELAY_MIN": 0.3,  // 增大延迟
  "STEALTH_DELAY_MAX": 0.8,
  "ACTION_DELAY_MIN": 0.5,
  "ACTION_DELAY_MAX": 1.0
}
```

并且：
- 降低请求频率
- 保持浏览器窗口可见
- 避免同时多个请求

---

### 场景5：CPU 占用高

**现象**：服务运行时 CPU 占用很高

**解决方案**：

```json
// browser_config.json
{
  "STREAM_CHECK_INTERVAL_MIN": 0.3,  // 增大检查间隔
  "STREAM_CHECK_INTERVAL_MAX": 2.0
}
```

---

## 总结

### 优先级

**必须配置**：
1. `BROWSER_PORT` - 与 Chrome 启动参数一致
2. `selectors.input_box` - 输入框
3. `selectors.send_btn` - 发送按钮
4. `selectors.result_container` - 回复容器

**重要配置**：
1. `STREAM_SILENCE_THRESHOLD` - 完成判定阈值
2. `stealth` - 是否隐身模式
3. `AUTH_TOKEN` - 暴露公网时必须

**可选配置**：
1. `HELPER_API_KEY` - 自动识别新站点
2. `stream_config` - 站点级调优
3. 其他高级参数 - 特殊场景使用

### 修改生效方式

| 配置类型 | 文件 | 生效方式 |
|---------|------|---------|
| 环境变量 | `.env` | **需重启服务** |
| 浏览器常量 | `browser_config.json` | **立即生效（热更新）** |
| 站点配置 | `sites.json` | **立即生效（热更新）** |

### 调试工具

1. **Dashboard** - http://127.0.0.1:8199/dashboard
   - 测试选择器（高亮显示）
   - 实时查看日志
   - 编辑配置

2. **API 文档** - http://127.0.0.1:8199/docs
   - 测试接口
   - 查看请求/响应

3. **日志**
   ```bash
   # 启用详细日志
   LOG_LEVEL=DEBUG python main.py
